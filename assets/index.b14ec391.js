var K=Object.defineProperty,D=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var y=(r,t,i)=>t in r?K(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,u=(r,t)=>{for(var i in t||(t={}))P.call(t,i)&&y(r,i,t[i]);if(v)for(var i of v(t))I.call(t,i)&&y(r,i,t[i]);return r},C=(r,t)=>D(r,F(t));var a=(r,t,i)=>(y(r,typeof t!="symbol"?t+"":t,i),i);import{c as O,u as A,n as B,G as m,T as G,R as H,C as T,A as X,P as Y}from"./vendor.6a9bd024.js";const N=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}};N();const M={layout:[],selectedKey:null},w=O(()=>{w.set(M)});function W(r){A(w,t=>C(u({},t),{selectedKey:r}))}const L={selectKey:W},j={layout:w};class z{constructor(t){a(this,"id",B());a(this,"_graphics",new m);a(this,"_pivotGraphics",new m);a(this,"_subscriptions",[]);a(this,"_app");a(this,"_appSettings");a(this,"_position");a(this,"_secondaryPosition");a(this,"_size");a(this,"_secondarySize");a(this,"_pivot");a(this,"_angle");a(this,"_legends");this._app=t.app,this._appSettings=t.appSettings,this._position=t.position,this._size=t.size,this._secondaryPosition=t.secondaryPosition,this._secondarySize=t.secondarySize,this._pivot=t.pivot,this._angle=t.angle,this._legends=t.legends,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return u({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return u({},this._size)}get width(){return this._size.width}get height(){return this._size.height}get unitSize(){return this._appSettings.unitSize}get surfaceWidth(){return this._size.width*this.unitSize-1-this.unitSize*.2}get surfaceHeight(){return this._size.height*this.unitSize-1-this.unitSize*.2}get surfaceX(){return this.unitSize*.1}get surfaceY(){return this.unitSize*.05}moveBy(t){this._graphics.x+=t.x,this._graphics.y+=t.y}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){L.selectKey(this.id),t.stopPropagation()}_draw(){var l,n;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,o=((n=(l=this._app.state)==null?void 0:l.layout.value)==null?void 0:n.selectedKey)===this.id;this._graphics.pivot.set((this._pivot.x-this._position.x)*t,(this._pivot.y-this._position.y)*t),this._graphics.position.x=this._position.x*t+this._graphics.pivot.x,this._graphics.position.y=this._position.y*t+this._graphics.pivot.y;const e=this._size.width*t-1,s=this._size.height*t-1;this._pivotGraphics.clear(),this._graphics.clear(),this._graphics.removeChildren(),this._pivotGraphics.zIndex=this._graphics.zIndex=o?100:1,this._pivotGraphics.beginFill(16711680),this._pivotGraphics.position.set(this._pivot.x*t,this._pivot.y*t),this._pivotGraphics.drawCircle(0,0,5),this._pivotGraphics.endFill(),this._pivotGraphics.visible=o,this._graphics.angle=this._angle,this._graphics.lineStyle({width:1,color:o?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(0,0,e,s,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(this.surfaceX,this.surfaceY,this.surfaceWidth,this.surfaceHeight,i*t*.8),this._graphics.endFill(),this._drawLegends()}_drawLegends(){const t=this.unitSize*.05,i=this._size.height*this.unitSize-1,o=this.surfaceWidth-t*2,e=this.surfaceHeight-t*2,s=this.surfaceX+t,l=this.surfaceY+t;for(let[n,p]of Object.entries(this._legends))if(p==null?void 0:p.length){const h=new G(p,{fontSize:e/3});let c,d;switch(n){case"topLeft":c={x:s,y:l},d={x:0,y:0};break;case"top":c={x:s+o/2,y:l},d={x:h.width/2,y:0};break;case"topRight":c={x:s+o,y:l},d={x:h.width,y:0};break;case"left":c={x:s,y:l+e/2},d={x:0,y:h.height/2};break;case"center":c={x:s+o/2,y:l+e/2},d={x:h.width/2,y:h.height/2};break;case"right":c={x:s+o,y:l+e/2},d={x:h.width,y:h.height/2};break;case"bottomLeft":c={x:s,y:l+e},d={x:0,y:h.height};break;case"bottom":c={x:s+o/2,y:l+e},d={x:h.width/2,y:h.height};break;case"bottomRight":c={x:s+o,y:l+e},d={x:h.width,y:h.height};break;case"frontLeft":h.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:s,y:i+t/2-1},d={x:0,y:h.height};break;case"front":h.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:s+o/2,y:i+t/2-1},d={x:h.width/2,y:h.height};break;case"frontRight":h.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:s+o,y:i+t/2-1},d={x:h.width,y:h.height};break}h.position.set(c.x,c.y),h.pivot.set(d.x,d.y),this._graphics.addChild(h)}}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),t.addChild(this._pivotGraphics),this}}const q=[["topLeft","bottomLeft","topRight","bottomRight","frontLeft","frontRight","left","right","top","center","bottom","front"],["top","bottom",null,null,"frontLeft","frontRight","center",null,null,null,null,"front"],["left",null,"right",null,"frontLeft","frontRight",null,null,"center",null,null,"front"],["center",null,null,null,"frontLeft","frontRight",null,null,null,null,null,"front"],["topLeft","bottomLeft","topRight","bottomRight","front",null,"left","right","top","center","bottom",null],["top","bottom",null,null,"front",null,"center",null,null,null,null,null],["left",null,"right",null,"front",null,null,null,"center",null,null,null],["center",null,null,null,"front",null,null,null,null,null,null,null]];function*J(r){var o,e,s;const t={x:0,y:0,rx:0,ry:0,h:1,w:1,a:4},i={x:0,y:0};for(const l of r)if(!!Array.isArray(l)){for(const n of l)if(typeof n=="object")"rx"in n&&(t.rx=i.x=n.rx,t.x=i.x,t.y=i.y),"ry"in n&&(t.ry=i.y=n.ry,t.x=i.x,t.y=i.y),n.x&&(t.x+=n.x),n.y&&(t.y+=n.y),"r"in n&&(t.r=n.r),"w"in n&&(t.w=n.w),"h"in n&&(t.h=n.h),"h2"in n&&!("h"in n)?t.h=n.h2:"h2"in n&&(t.h2=n.h2),"w2"in n&&!("w"in n)?t.w=n.w2:"w2"in n&&(t.w2=n.w2),"a"in n&&(t.a=n.a);else{const p={x:t.x,y:t.y},h={width:t.w||t.w2||1,height:t.h||t.h2||1},c={x:(o=t.rx)!=null?o:0,y:(e=t.ry)!=null?e:0},d=(s=t.r)!=null?s:0,x={};if(n.length){const S=n.split(`
`),R=q[t.a];for(let _=0;_<S.length;_++){const b=S[_],k=R[_];b.length&&k&&(x[k]=b)}}yield{position:p,size:h,pivot:c,angle:d,legends:x},t.x+=h.width,t.w=t.h=1,t.x2=t.y2=t.w2=t.h2=0}++t.y,t.x=t.rx}}class Q{constructor(t,i){a(this,"_container",new T);a(this,"_layoutOffset",{x:1,y:1});a(this,"_keyCaps",[]);a(this,"_kleFileInput");a(this,"_fileReader",new FileReader);a(this,"_dragging",!1);a(this,"_draggingData");this._app=t,this._appSettings=i,this._container.hitArea=new H(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var t,i;(t=document.getElementById("layout-editor__add-key"))==null||t.addEventListener("click",this._handleAddButtonClick),(i=document.getElementById("layout-editor__load-kle"))==null||i.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._container.on("pointerdown",this._handleContainerClick),this._container.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],o=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,e=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:o,y:e}}else t=u({},this._layoutOffset);this._keyCaps.push(new z({app:this._app,appSettings:this._appSettings,position:t,size:{width:1,height:1}}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&L.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(t){var e;const o=(e=t.target.files)==null?void 0:e[0];o&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(o))}_parseKLEFile(t){const i=t.target;if(i.result){const o=JSON.parse(i.result);let e;for(const s of J(o))e=new z({app:this._app,appSettings:this._appSettings,position:s.position,size:s.size,pivot:s.pivot,angle:s.angle,legends:s.legends}),this._keyCaps.push(e.appendTo(this._container))}}_handleDragStart(t){this._draggingData=t.data.getLocalPosition(this._container.parent),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._container.cursor="default"}_handleDragMove(t){if(this._dragging&&this._draggingData){this._container.cursor="grabbing";const i=t.data.getLocalPosition(this._container.parent),o=i.x-this._draggingData.x,e=i.y-this._draggingData.y;for(const s of this._keyCaps)s.moveBy({x:o,y:e});this._draggingData=i}}}const g=document.getElementById("pixi-container"),f=new X({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,autoDensity:!0,resizeTo:g,width:g==null?void 0:g.clientWidth,height:g==null?void 0:g.clientHeight});f.state=j;f.stage.sortableChildren=!0;const U={unitSize:70,keyCapCornerRadius:.1};var E;if(g){const r=document.getElementsByTagName("canvas");for(const t of Array.from(r))(E=t.parentNode)==null||E.removeChild(t)}g==null||g.appendChild(f.view);window.__PIXI_INSPECTOR_GLOBAL_HOOK__&&window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({PIXI:Y});new Q(f,U);
