var F=Object.defineProperty,O=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var f=(h,t,i)=>t in h?F(h,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[t]=i,u=(h,t)=>{for(var i in t||(t={}))A.call(t,i)&&f(h,i,t[i]);if(m)for(var i of m(t))B.call(t,i)&&f(h,i,t[i]);return h},L=(h,t)=>O(h,I(t));var r=(h,t,i)=>(f(h,typeof t!="symbol"?t+"":t,i),i);import{c as H,u as T,k as X,l as Y,w as z,n as M,G as N,s as x,T as W,C as G,R as j,A as q,P as J}from"./vendor.e680a832.js";const Q=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}};Q();const U={layout:[],selectedKey:null},w=H(()=>{w.set(U)});function V(h){T(w,t=>L(u({},t),{selectedKey:h}))}const v={selectKey:V},Z={layout:w},$=[["topLeft","bottomLeft","topRight","bottomRight","frontLeft","frontRight","left","right","top","center","bottom","front"],["top","bottom",null,null,"frontLeft","frontRight","center",null,null,null,null,"front"],["left",null,"right",null,"frontLeft","frontRight",null,null,"center",null,null,"front"],["center",null,null,null,"frontLeft","frontRight",null,null,null,null,null,"front"],["topLeft","bottomLeft","topRight","bottomRight","front",null,"left","right","top","center","bottom",null],["top","bottom",null,null,"front",null,"center",null,null,null,null,null],["left",null,"right",null,"front",null,null,null,"center",null,null,null],["center",null,null,null,"front",null,null,null,null,null,null,null]];function*tt(h){var e,n,o;const t={x:0,y:0,rx:0,ry:0,h:1,w:1,a:4,c:"#cccccc",t:"#000000"},i={x:0,y:0};for(const l of h){if(!Array.isArray(l)){yield u({},l);continue}for(const s of l)if(typeof s=="object")"rx"in s&&(t.rx=i.x=s.rx,t.x=i.x,t.y=i.y),"ry"in s&&(t.ry=i.y=s.ry,t.x=i.x,t.y=i.y),s.x&&(t.x+=s.x),s.y&&(t.y+=s.y),"r"in s&&(t.r=s.r),"w"in s&&(t.w=s.w),"h"in s&&(t.h=s.h),"h2"in s&&!("h"in s)?t.h=s.h2:"h2"in s&&(t.h2=s.h2),"w2"in s&&!("w"in s)?t.w=s.w2:"w2"in s&&(t.w2=s.w2),"a"in s&&(t.a=s.a),"c"in s&&(t.c=s.c),"t"in s&&(t.t=s.t);else{const p={x:t.x,y:t.y},a={width:t.w||t.w2||1,height:t.h||t.h2||1},c={x:(e=t.rx)!=null?e:0,y:(n=t.ry)!=null?n:0},d=(o=t.r)!=null?o:0,b={};if(s.length){const k=s.split(`
`),D=t.t.split(`
`),P=$[t.a];for(let _=0;_<k.length;_++){const S=k[_],C=P[_];S.length&&C&&(b[C]={text:S,color:D[_]||"#000000"})}}yield{position:p,size:a,pivot:c,angle:d,legends:b,color:t.c},t.x+=a.width,t.w=t.h=1,t.x2=t.y2=t.w2=t.h2=0}++t.y,t.x=t.rx}}X([Y]);function E(h,t){const i=z(h).toLab();return i.l=Math.min(100,i.l*t),z(i).toHex()}const it={pivot:{x:0,y:0},size:{width:1,height:1},legends:{},color:"#cccccc",angle:0};class K{constructor(t){r(this,"id",M());r(this,"_graphics",new N);r(this,"_subscriptions",[]);r(this,"_app");r(this,"_appSettings");r(this,"_position");r(this,"_secondaryPosition");r(this,"_size");r(this,"_secondarySize");r(this,"_pivot");r(this,"_angle");r(this,"_legends");r(this,"_keycapColor");const i=u(u({},it),t);this._app=i.app,this._appSettings=i.appSettings,this._position=i.position,this._size=i.size,this._secondaryPosition=i.secondaryPosition,this._secondarySize=i.secondarySize,this._pivot=i.pivot,this._angle=i.angle,this._legends=i.legends,this._keycapColor=i.color,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return u({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return u({},this._size)}get width(){return this._size.width}get height(){return this._size.height}get unitSize(){return this._appSettings.unitSize}get surfaceWidth(){return this._size.width*this.unitSize-1-this.unitSize*.2}get surfaceHeight(){return this._size.height*this.unitSize-1-this.unitSize*.2}get surfaceX(){return this.unitSize*.1}get surfaceY(){return this.unitSize*.05}moveBy(t){this._graphics.x+=t.x,this._graphics.y+=t.y}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){v.selectKey(this.id),t.stopPropagation()}_draw(){var p,a;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,e=((a=(p=this._app.state)==null?void 0:p.layout.value)==null?void 0:a.selectedKey)===this.id,n=E(this._keycapColor,1.2),o=E(this._keycapColor,.9);this._graphics.pivot.set((this._pivot.x-this._position.x)*t,(this._pivot.y-this._position.y)*t),this._graphics.position.x=this._position.x*t+this._graphics.pivot.x,this._graphics.position.y=this._position.y*t+this._graphics.pivot.y;const l=this._size.width*t-1,s=this._size.height*t-1;this._graphics.clear(),this._graphics.removeChildren(),this._graphics.angle=this._angle,this._graphics.lineStyle({width:1,color:e?15026179:0}),this._graphics.beginFill(x(this._keycapColor)),this._graphics.drawRoundedRect(0,0,l,s,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:x(o)}),this._graphics.beginFill(x(n)),this._graphics.drawRoundedRect(this.surfaceX,this.surfaceY,this.surfaceWidth,this.surfaceHeight,i*t*.8),this._graphics.endFill(),this._drawLegends()}_drawLegends(){const t=this.unitSize*.05,i=this._size.height*this.unitSize-1,e=this.surfaceWidth-t*2,n=this.surfaceHeight-t*2,o=this.surfaceX+t,l=this.surfaceY+t;for(const[s,p]of Object.entries(this._legends))if(p==null?void 0:p.text.length){const a=new W(p.text,{fontSize:n/3,fill:p.color});let c,d;switch(s){case"topLeft":c={x:o,y:l},d={x:0,y:0};break;case"top":c={x:o+e/2,y:l},d={x:a.width/2,y:0};break;case"topRight":c={x:o+e,y:l},d={x:a.width,y:0};break;case"left":c={x:o,y:l+n/2},d={x:0,y:a.height/2};break;case"center":c={x:o+e/2,y:l+n/2},d={x:a.width/2,y:a.height/2};break;case"right":c={x:o+e,y:l+n/2},d={x:a.width,y:a.height/2};break;case"bottomLeft":c={x:o,y:l+n},d={x:0,y:a.height};break;case"bottom":c={x:o+e/2,y:l+n},d={x:a.width/2,y:a.height};break;case"bottomRight":c={x:o+e,y:l+n},d={x:a.width,y:a.height};break;case"frontLeft":a.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:o,y:i+t/2-1},d={x:0,y:a.height};break;case"front":a.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:o+e/2,y:i+t/2-1},d={x:a.width/2,y:a.height};break;case"frontRight":a.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:o+e,y:i+t/2-1},d={x:a.width,y:a.height};break}a.position.set(c.x,c.y),a.pivot.set(d.x,d.y),this._graphics.addChild(a)}}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}class et{constructor(t,i){r(this,"container",new G);r(this,"_metadata",{});r(this,"_keyCaps",[]);this._app=t,this._appSettings=i,this.container.sortableChildren=!0,console.log(this)}importKLEData(t){let i;for(const e of tt(t))"position"in e?(i=new K({app:this._app,appSettings:this._appSettings,position:e.position,size:e.size,pivot:e.pivot,angle:e.angle,legends:e.legends,color:e.color}),this._keyCaps.push(i.appendTo(this.container))):this._metadata=e}moveBy(t){this.container.x+=t.x,this.container.y+=t.y}addKeyCap(){let t={x:0,y:0};if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],e=i.position.x>=15?0:i.position.x+i.size.width,n=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:e,y:n}}this._keyCaps.push(new K({app:this._app,appSettings:this._appSettings,position:t,size:{width:1,height:1}}).appendTo(this.container))}}class st{constructor(t,i){r(this,"_layoutOffset",{x:1,y:1});r(this,"_kleFileInput");r(this,"_fileReader",new FileReader);r(this,"_keyboard");r(this,"_dragging",!1);r(this,"_draggingData");this._app=t,this._appSettings=i;const e=this._appSettings.unitSize;this._keyboard=new et(this._app,this._appSettings),this._keyboard.container.position.set(this._layoutOffset.x*e,this._layoutOffset.y*e),this._app.stage.addChild(this._keyboard.container),this._app.stage.interactive=!0,this._app.stage.hitArea=new j(0,0,t.view.width,t.view.height),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var t,i;(t=document.getElementById("layout-editor__add-key"))==null||t.addEventListener("click",this._handleAddButtonClick),(i=document.getElementById("layout-editor__load-kle"))==null||i.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._app.stage.on("pointerdown",this._handleContainerClick),this._app.stage.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){this._keyboard.addKeyCap()}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&v.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(t){var n;const e=(n=t.target.files)==null?void 0:n[0];e&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(e))}_parseKLEFile(t){const i=t.target;if(i.result){const e=JSON.parse(i.result);this._keyboard.importKLEData(e)}}_handleDragStart(t){this._draggingData=t.data.getLocalPosition(this._app.stage),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._app.stage.cursor="default"}_handleDragMove(t){if(this._dragging&&this._draggingData){this._app.stage.cursor="grabbing";const i=t.data.getLocalPosition(this._app.stage),e=i.x-this._draggingData.x,n=i.y-this._draggingData.y;this._keyboard.moveBy({x:e,y:n}),this._draggingData=i}}}const g=document.getElementById("pixi-container"),y=new q({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,autoDensity:!0,resizeTo:g,width:g==null?void 0:g.clientWidth,height:g==null?void 0:g.clientHeight});y.state=Z;y.stage.sortableChildren=!0;const nt={unitSize:70,keyCapCornerRadius:.1};var R;if(g){const h=document.getElementsByTagName("canvas");for(const t of Array.from(h))(R=t.parentNode)==null||R.removeChild(t)}g==null||g.appendChild(y.view);window.__PIXI_INSPECTOR_GLOBAL_HOOK__&&window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({PIXI:J});new st(y,nt);
