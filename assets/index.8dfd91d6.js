var F=Object.defineProperty,I=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var y=(a,t,i)=>t in a?F(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,_=(a,t)=>{for(var i in t||(t={}))A.call(t,i)&&y(a,i,t[i]);if(L)for(var i of L(t))B.call(t,i)&&y(a,i,t[i]);return a},m=(a,t)=>I(a,O(t));var h=(a,t,i)=>(y(a,typeof t!="symbol"?t+"":t,i),i);import{c as H,u as T,k as X,l as Y,w as v,n as M,G as N,s as x,T as W,R as G,C as j,A as q,P as J}from"./vendor.e680a832.js";const Q=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}};Q();const U={layout:[],selectedKey:null},w=H(()=>{w.set(U)});function V(a){T(w,t=>m(_({},t),{selectedKey:a}))}const z={selectKey:V},Z={layout:w};X([Y]);function E(a,t){const i=v(a).toLab();return i.l=Math.min(100,i.l*t),v(i).toHex()}class R{constructor(t){h(this,"id",M());h(this,"_graphics",new N);h(this,"_subscriptions",[]);h(this,"_app");h(this,"_appSettings");h(this,"_position");h(this,"_secondaryPosition");h(this,"_size");h(this,"_secondarySize");h(this,"_pivot");h(this,"_angle");h(this,"_legends");h(this,"_keycapColor");this._app=t.app,this._appSettings=t.appSettings,this._position=t.position,this._size=t.size,this._secondaryPosition=t.secondaryPosition,this._secondarySize=t.secondarySize,this._pivot=t.pivot,this._angle=t.angle,this._legends=t.legends,this._keycapColor=t.color||"#cccccc",this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return _({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return _({},this._size)}get width(){return this._size.width}get height(){return this._size.height}get unitSize(){return this._appSettings.unitSize}get surfaceWidth(){return this._size.width*this.unitSize-1-this.unitSize*.2}get surfaceHeight(){return this._size.height*this.unitSize-1-this.unitSize*.2}get surfaceX(){return this.unitSize*.1}get surfaceY(){return this.unitSize*.05}moveBy(t){this._graphics.x+=t.x,this._graphics.y+=t.y}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){z.selectKey(this.id),t.stopPropagation()}_draw(){var u,o;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,r=((o=(u=this._app.state)==null?void 0:u.layout.value)==null?void 0:o.selectedKey)===this.id,e=E(this._keycapColor,1.2),s=E(this._keycapColor,.9);this._graphics.pivot.set((this._pivot.x-this._position.x)*t,(this._pivot.y-this._position.y)*t),this._graphics.position.x=this._position.x*t+this._graphics.pivot.x,this._graphics.position.y=this._position.y*t+this._graphics.pivot.y;const l=this._size.width*t-1,n=this._size.height*t-1;this._graphics.clear(),this._graphics.removeChildren(),this._graphics.angle=this._angle,this._graphics.lineStyle({width:1,color:r?15026179:0}),this._graphics.beginFill(x(this._keycapColor)),this._graphics.drawRoundedRect(0,0,l,n,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:x(s)}),this._graphics.beginFill(x(e)),this._graphics.drawRoundedRect(this.surfaceX,this.surfaceY,this.surfaceWidth,this.surfaceHeight,i*t*.8),this._graphics.endFill(),this._drawLegends()}_drawLegends(){const t=this.unitSize*.05,i=this._size.height*this.unitSize-1,r=this.surfaceWidth-t*2,e=this.surfaceHeight-t*2,s=this.surfaceX+t,l=this.surfaceY+t;for(const[n,u]of Object.entries(this._legends))if(u==null?void 0:u.text.length){const o=new W(u.text,{fontSize:e/3,fill:u.color});let c,d;switch(n){case"topLeft":c={x:s,y:l},d={x:0,y:0};break;case"top":c={x:s+r/2,y:l},d={x:o.width/2,y:0};break;case"topRight":c={x:s+r,y:l},d={x:o.width,y:0};break;case"left":c={x:s,y:l+e/2},d={x:0,y:o.height/2};break;case"center":c={x:s+r/2,y:l+e/2},d={x:o.width/2,y:o.height/2};break;case"right":c={x:s+r,y:l+e/2},d={x:o.width,y:o.height/2};break;case"bottomLeft":c={x:s,y:l+e},d={x:0,y:o.height};break;case"bottom":c={x:s+r/2,y:l+e},d={x:o.width/2,y:o.height};break;case"bottomRight":c={x:s+r,y:l+e},d={x:o.width,y:o.height};break;case"frontLeft":o.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:s,y:i+t/2-1},d={x:0,y:o.height};break;case"front":o.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:s+r/2,y:i+t/2-1},d={x:o.width/2,y:o.height};break;case"frontRight":o.style.fontSize=i-this.surfaceHeight-this.surfaceY,c={x:s+r,y:i+t/2-1},d={x:o.width,y:o.height};break}o.position.set(c.x,c.y),o.pivot.set(d.x,d.y),this._graphics.addChild(o)}}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}const $=[["topLeft","bottomLeft","topRight","bottomRight","frontLeft","frontRight","left","right","top","center","bottom","front"],["top","bottom",null,null,"frontLeft","frontRight","center",null,null,null,null,"front"],["left",null,"right",null,"frontLeft","frontRight",null,null,"center",null,null,"front"],["center",null,null,null,"frontLeft","frontRight",null,null,null,null,null,"front"],["topLeft","bottomLeft","topRight","bottomRight","front",null,"left","right","top","center","bottom",null],["top","bottom",null,null,"front",null,"center",null,null,null,null,null],["left",null,"right",null,"front",null,null,null,"center",null,null,null],["center",null,null,null,"front",null,null,null,null,null,null,null]];function*tt(a){var r,e,s;const t={x:0,y:0,rx:0,ry:0,h:1,w:1,a:4,c:"#cccccc",t:"#000000"},i={x:0,y:0};for(const l of a)if(!!Array.isArray(l)){for(const n of l)if(typeof n=="object")"rx"in n&&(t.rx=i.x=n.rx,t.x=i.x,t.y=i.y),"ry"in n&&(t.ry=i.y=n.ry,t.x=i.x,t.y=i.y),n.x&&(t.x+=n.x),n.y&&(t.y+=n.y),"r"in n&&(t.r=n.r),"w"in n&&(t.w=n.w),"h"in n&&(t.h=n.h),"h2"in n&&!("h"in n)?t.h=n.h2:"h2"in n&&(t.h2=n.h2),"w2"in n&&!("w"in n)?t.w=n.w2:"w2"in n&&(t.w2=n.w2),"a"in n&&(t.a=n.a),"c"in n&&(t.c=n.c),"t"in n&&(t.t=n.t);else{const u={x:t.x,y:t.y},o={width:t.w||t.w2||1,height:t.h||t.h2||1},c={x:(r=t.rx)!=null?r:0,y:(e=t.ry)!=null?e:0},d=(s=t.r)!=null?s:0,k={};if(n.length){const S=n.split(`
`),D=t.t.split(`
`),P=$[t.a];for(let p=0;p<S.length;p++){const b=S[p],C=P[p];b.length&&C&&(k[C]={text:b,color:D[p]||"#000000"})}}yield{position:u,size:o,pivot:c,angle:d,legends:k,color:t.c},t.x+=o.width,t.w=t.h=1,t.x2=t.y2=t.w2=t.h2=0}++t.y,t.x=t.rx}}class it{constructor(t,i){h(this,"_container",new j);h(this,"_layoutOffset",{x:1,y:1});h(this,"_keyCaps",[]);h(this,"_kleFileInput");h(this,"_fileReader",new FileReader);h(this,"_dragging",!1);h(this,"_draggingData");this._app=t,this._appSettings=i,this._container.hitArea=new G(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var t,i;(t=document.getElementById("layout-editor__add-key"))==null||t.addEventListener("click",this._handleAddButtonClick),(i=document.getElementById("layout-editor__load-kle"))==null||i.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._container.on("pointerdown",this._handleContainerClick),this._container.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],r=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,e=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:r,y:e}}else t=_({},this._layoutOffset);this._keyCaps.push(new R({app:this._app,appSettings:this._appSettings,position:t,size:{width:1,height:1}}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&z.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(t){var e;const r=(e=t.target.files)==null?void 0:e[0];r&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(r))}_parseKLEFile(t){const i=t.target;if(i.result){const r=JSON.parse(i.result);let e;for(const s of tt(r))e=new R({app:this._app,appSettings:this._appSettings,position:s.position,size:s.size,pivot:s.pivot,angle:s.angle,legends:s.legends,color:s.color}),this._keyCaps.push(e.appendTo(this._container))}}_handleDragStart(t){this._draggingData=t.data.getLocalPosition(this._container.parent),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._container.cursor="default"}_handleDragMove(t){if(this._dragging&&this._draggingData){this._container.cursor="grabbing";const i=t.data.getLocalPosition(this._container.parent),r=i.x-this._draggingData.x,e=i.y-this._draggingData.y;for(const s of this._keyCaps)s.moveBy({x:r,y:e});this._draggingData=i}}}const g=document.getElementById("pixi-container"),f=new q({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,autoDensity:!0,resizeTo:g,width:g==null?void 0:g.clientWidth,height:g==null?void 0:g.clientHeight});f.state=Z;f.stage.sortableChildren=!0;const et={unitSize:70,keyCapCornerRadius:.1};var K;if(g){const a=document.getElementsByTagName("canvas");for(const t of Array.from(a))(K=t.parentNode)==null||K.removeChild(t)}g==null||g.appendChild(f.view);window.__PIXI_INSPECTOR_GLOBAL_HOOK__&&window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({PIXI:J});new it(f,et);
