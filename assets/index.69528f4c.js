var m=Object.defineProperty,E=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var p=(o,i,t)=>i in o?m(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,d=(o,i)=>{for(var t in i||(i={}))b.call(i,t)&&p(o,t,i[t]);if(u)for(var t of u(i))D.call(i,t)&&p(o,t,i[t]);return o},y=(o,i)=>E(o,L(i));var a=(o,i,t)=>(p(o,typeof i!="symbol"?i+"":i,t),t);import{c as z,u as K,n as F,G as f,R as I,C as P,A as O,P as R}from"./vendor.17c4c35c.js";const A=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))h(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&h(l)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function h(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}};A();const B={layout:[],selectedKey:null},_=z(()=>{_.set(B)});function G(o){K(_,i=>y(d({},i),{selectedKey:o}))}const w={selectKey:G},N={layout:_};class v{constructor(i,t){a(this,"id",F());a(this,"_graphics",new f);a(this,"_pivotGraphics",new f);a(this,"_subscriptions",[]);a(this,"_app");a(this,"_appSettings");a(this,"_position");a(this,"_secondaryPosition");a(this,"_size");a(this,"_secondarySize");a(this,"_pivot");a(this,"_angle");this.customData=t,this._app=i.app,this._appSettings=i.appSettings,this._position=i.position,this._size=i.size,this._secondaryPosition=i.secondaryPosition,this._secondarySize=i.secondarySize,this._pivot=i.pivot,this._angle=i.angle,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return d({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return d({},this._size)}get width(){return this._size.width}get height(){return this._size.height}moveBy(i){this._graphics.x+=i.x,this._graphics.y+=i.y}_initSubscriptions(){var i;this._subscriptions.push((i=this._app.state)==null?void 0:i.layout.listen(()=>this._draw()))}_onClick(i){w.selectKey(this.id),this.customData&&console.log(this.customData,this),i.stopPropagation()}_draw(){var l,s;const i=this._appSettings.unitSize,t=this._appSettings.keyCapCornerRadius,h=((s=(l=this._app.state)==null?void 0:l.layout.value)==null?void 0:s.selectedKey)===this.id;this._graphics.pivot.set((this._pivot.x-this._position.x)*i,(this._pivot.y-this._position.y)*i),this._graphics.position.x=this._position.x*i+this._graphics.pivot.x,this._graphics.position.y=this._position.y*i+this._graphics.pivot.y;const e=this._size.width*i-1,n=this._size.height*i-1;this._pivotGraphics.clear(),this._graphics.clear(),this._pivotGraphics.zIndex=this._graphics.zIndex=h?100:1,this._pivotGraphics.beginFill(16711680),this._pivotGraphics.position.set(this._pivot.x*i,this._pivot.y*i),this._pivotGraphics.drawCircle(0,0,5),this._pivotGraphics.endFill(),this._pivotGraphics.visible=h,this._graphics.angle=this._angle,this._graphics.lineStyle({width:1,color:h?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(0,0,e,n,t*i),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(i*.1,i*.07,e-i*.2,n-i*.2,t*i*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const i of this._subscriptions)i==null||i()}appendTo(i){return i.addChild(this._graphics),i.addChild(this._pivotGraphics),this}}function*T(o){var h,e,n;const i={x:0,y:0,rx:0,ry:0,h:1,w:1},t={x:0,y:0};for(const l of o)if(!!Array.isArray(l)){for(const s of l)if(typeof s=="object")"rx"in s&&(i.rx=t.x=s.rx,i.x=t.x,i.y=t.y),"ry"in s&&(i.ry=t.y=s.ry,i.x=t.x,i.y=t.y),s.x&&(i.x+=s.x),s.y&&(i.y+=s.y),"r"in s&&(i.r=s.r),"w"in s&&(i.w=s.w),"h"in s&&(i.h=s.h),"h2"in s&&!("h"in s)?i.h=s.h2:"h2"in s&&(i.h2=s.h2),"w2"in s&&!("w"in s)?i.w=s.w2:"w2"in s&&(i.w2=s.w2);else{const C={x:i.x,y:i.y},g={width:i.w||i.w2||1,height:i.h||i.h2||1},k={x:(h=i.rx)!=null?h:0,y:(e=i.ry)!=null?e:0},S=(n=i.r)!=null?n:0;yield{position:C,size:g,pivot:k,angle:S},i.x+=g.width,i.w=i.h=1,i.x2=i.y2=i.w2=i.h2=0}++i.y,i.x=i.rx}}class M{constructor(i,t){a(this,"_container",new P);a(this,"_layoutOffset",{x:1,y:1});a(this,"_keyCaps",[]);a(this,"_kleFileInput");a(this,"_fileReader",new FileReader);a(this,"_dragging",!1);a(this,"_draggingData");this._app=i,this._appSettings=t,this._container.hitArea=new I(0,0,i.view.width,i.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var i,t;(i=document.getElementById("layout-editor__add-key"))==null||i.addEventListener("click",this._handleAddButtonClick),(t=document.getElementById("layout-editor__load-kle"))==null||t.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._container.on("pointerdown",this._handleContainerClick),this._container.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){let i;if(this._keyCaps.length){const t=this._keyCaps[this._keyCaps.length-1],h=t.position.x>=15?this._layoutOffset.x:t.position.x+t.size.width,e=t.position.x>=15?t.position.y+t.size.height:t.position.y;i={x:h,y:e}}else i=d({},this._layoutOffset);this._keyCaps.push(new v({app:this._app,appSettings:this._appSettings,position:i,size:{width:1,height:1}}).appendTo(this._container))}_handleContainerClick(){var i,t;((t=(i=this._app.state)==null?void 0:i.layout.value)==null?void 0:t.selectedKey)&&w.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(i){var e;const h=(e=i.target.files)==null?void 0:e[0];h&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(h))}_parseKLEFile(i){const t=i.target;if(t.result){const h=JSON.parse(t.result);let e;for(const n of T(h))e=new v({app:this._app,appSettings:this._appSettings,position:n.position,size:n.size,pivot:n.pivot,angle:n.angle}),this._keyCaps.push(e.appendTo(this._container))}}_handleDragStart(i){this._draggingData=i.data.getLocalPosition(this._container.parent),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._container.cursor="default"}_handleDragMove(i){if(this._dragging&&this._draggingData){this._container.cursor="grabbing";const t=i.data.getLocalPosition(this._container.parent),h=t.x-this._draggingData.x,e=t.y-this._draggingData.y;for(const n of this._keyCaps)n.moveBy({x:h,y:e});this._draggingData=t}}}const r=document.getElementById("pixi-container"),c=new O({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,autoDensity:!0,resizeTo:r,width:r==null?void 0:r.clientWidth,height:r==null?void 0:r.clientHeight});c.state=N;c.stage.sortableChildren=!0;const X={unitSize:70,keyCapCornerRadius:.1};var x;if(r){const o=document.getElementsByTagName("canvas");for(const i of Array.from(o))(x=i.parentNode)==null||x.removeChild(i)}r==null||r.appendChild(c.view);window.__PIXI_INSPECTOR_GLOBAL_HOOK__&&window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({PIXI:R});new M(c,X);
